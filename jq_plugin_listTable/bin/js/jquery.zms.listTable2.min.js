!function($,window,document,template,layer,undefined){"use strict";function clone(e){var t;switch(typeof e){case"undefined":break;case"string":t=e+"";break;case"number":t=e-0;break;case"boolean":t=e;break;case"object":if(null===e)t=null;else if(e instanceof Array){t=[];for(var a=0,r=e.length;a<r;a++)t.push(clone(e[a]))}else{t={};for(var i in e)t[i]=clone(e[i])}break;default:t=e}return t}function clone2(e){var t,e;t=e.constructor==Object?new e.constructor:new e.constructor(e.valueOf());for(var a in e)t[a]!=e[a]&&("object"==typeof e[a]?t[a]=clone2(e[a]):t[a]=e[a]);return t.toString=e.toString,t.valueOf=e.valueOf,t}function clone3(e){function t(){}t.prototype=e;var a=new t;for(var r in a)"object"==typeof a[r]&&(a[r]=clone3(a[r]));return a}function tryFormatDate(date,format){var oldDate=date;if(date instanceof Date)date=new Date(date.getTime());else if("string"==typeof date&&date.indexOf("Date")<0){if(date=new Date(date),"Invalid Date"==date&&(date=new Date(oldDate.replaceAll("T"," ").replaceAll("-","/")),"Invalid Date"==date&&(date=new Date(oldDate.replaceAll("T"," ").replaceAll("-","/").split(".")[0]),"Invalid Date"==date)))return oldDate;date=new Date(date.getTime()-6e4*date.getTimezoneOffset()-288e5)}else{if("string"!=typeof date)return date;date=eval("new "+date.replaceAll("/","")),date=new Date(date)}var localTime=date.getTime(),serverOffset=6e4*date.getTimezoneOffset(),localOffset=6e4*(new Date).getTimezoneOffset(),utc=localTime-serverOffset+localOffset;date=new Date(utc);var map={M:date.getMonth()+1,d:date.getDate(),h:date.getHours(),m:date.getMinutes(),s:date.getSeconds(),q:Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};return format!=undefined&&"string"==typeof format||(format="yyyy-MM-dd hh:mm:ss"),format=format.replace(/([yMdhmsqS])+/g,function(e,t){var a=map[t];return a!==undefined?(e.length>1&&(a="0"+a,a=a.substr(a.length-2)),a):"y"===t?(date.getFullYear()+"").substr(4-e.length):e})}function turnData(e,t,a,r){try{var i=clone(t);if(i&&"object"==typeof i){var o={title:"Title",state:"State",username:"UserName",createTime:"CreateTime",datalist:"Remark",list:{id:"ID",title:"ApproveUserName",state:"State",appTime:"ApproveTime",createTime:"CreateTime",appUserName:"ApproveUserName",appContent:"ApproveComment",popTitle:"ApproveUserName",popContent:"ApproveComment"}};e=$.extend({},o,e);var s={ID:0,ApproveID:0,UserID:0,ApproveUser:0,ApproveUserName:i.UserName,ApproveComment:"commit approve",State:4,ApproveTime:i.CreateTime,CreateTime:i.CreateTime,Remark:"",ZMSCompanyID:0};i.Remark.insert(0,s);for(var l={title:i[e.title],state:i[e.state],username:i[e.username],createTime:i[e.createTime],list:i[e.datalist]},n=0;n<l.list.length&&!isNaN(l.list[n][e.list.state]);n++){var d={id:l.list[n][e.list.id],title:l.list[n][e.list.title],state:l.list[n][e.list.state],appTime:l.list[n][e.list.appTime],createTime:l.list[n][e.list.createTime],appUserName:l.list[n][e.list.appUserName],appContent:l.list[n][e.list.appContent],popTitle:l.list[n][e.list.popTitle],popContent:l.list[n][e.list.popContent]};l.list[n]=d}return void(a&&a(l))}r&&r({message:"进程展示插件参数有误!"})}catch(e){r&&r(e)}}function Plugin(e,t){this.element=e,this.options=$.extend({},defaults,t),this._defaults=defaults,this._name=pluginName,this._turnData=turnData,this.init(this)}var pluginName="zms_listTable",defaults={svgframe:"temp_zms_listTable_svgframe_default",bgcolor:"white",color:"gray",fontsize:"12",font:"Helvetica, Arial, sans-serif",overflow:"visible",icons:["min","full","plus"],size:{width:"600",height:"600",maxHeight:"600px",arrowHeight:76,raw:5,rx:10,ry:10},stateArray:[{state:0,name:"审批中",color1:"black",bgcolor1:"white",color2:"white",bgcolor2:"#23b7e5",arrowcolor:"#23b7e5"},{state:1,name:"通过",color1:"black",bgcolor1:"white",color2:"white",bgcolor2:"#f8b62d",arrowcolor:"#f8b62d"},{state:2,name:"驳回",color1:"black",bgcolor1:"white",color2:"white",bgcolor2:"#8312d8",arrowcolor:"#8312d8"},{state:3,name:"终止",color1:"black",bgcolor1:"white",color2:"white",bgcolor2:"#fb6e52",arrowcolor:"#fb6e52"},{state:4,name:"提交",color1:"black",bgcolor1:"white",color2:"white",bgcolor2:"#5CB95C   ",arrowcolor:"#5CB95C   "}],data:{Title:"审批表单名称",State:1,UserName:"申请人姓名",CreateTime:new Date,Remark:[{ID:79,ApproveID:78,UserID:3,ApproveUser:449,ApproveUserName:"123",ApproveComment:"sdasdsad",State:1,ApproveTime:"2016-09-27T13:16:01",CreateTime:"2016-09-27T13:16:01",Remark:"",ZMSCompanyID:1}]},renderMap:{title:"Title",state:"State",username:"UserName",createTime:"CreateTime",datalist:"Remark",list:{id:"ID",title:"ApproveUserName",state:"State",appTime:"ApproveTime",createTime:"CreateTime",appUserName:"ApproveUserName",appContent:"ApproveComment",popTitle:"ApproveUserName",popContent:"ApproveComment"}},nodeHover:function(e){return layer.open({type:1,shade:0,area:["500px","300px"],title:$(e).data("title"),content:$(e).data("content")})},error:function(e){layer.msg(e.message)},other:null},defaultTemplateHtml='<script type="text/template" id="temp_zms_listTable_svgframe_default"> <h3 style="text-align: center;vertical-align: middle;padding: 10px 0" width="{{size.width}}" height="50px">{{data.title}}</h3><svg rx="{{size.rx}}" ry="{{size.ry}}" width="{{size.width}}" height="{{size.height}}" xmlns="http://www.w3.org/2000/svg" style="max-height:{{size.maxHeight}};overflow:{{overflow}};"><defs> {{each stateArray}}<marker id="arrow_{{$value.state}}" markerUnits="strokeWidth" markerWidth="12"  markerHeight="12" viewBox="0 0 12 12" refX="6" refY="6" orient="auto"><path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill:{{$value.arrowcolor}};" /></marker> {{/each}}</defs> <g><rect fill="{{bgcolor}}" id="canvas_background" height="402" width="582" y="-1" x="-1" /><g display="none" overflow="visible" y="0" x="0" height="100%" width="100%" id="canvasGrid"> <rect fill="url(#gridpattern)" stroke-width="0" y="0" x="0" height="100%" width="100%" /></g> </g>{{each data.list}}<g class="zms_listTable node" data-title="{{$value.popTitle}}" data-content="{{$value.popContent}}"><rect stroke="{{stateArray[$value.state].bgcolor2}}" id="svg_1_{{$value.id}}" height="{{size.arrowHeight}}" width="{{size.arrowHeight*size.raw}}" y="{{size.arrowHeight*(3*$index+1)}}" x="{{(size.width-size.arrowHeight*size.raw)/2}}" stroke-width="0.5" fill="{{stateArray[$value.state].bgcolor1}}"> </rect> <rect stroke="{{stateArray[$value.state].bgcolor2}}" id="svg_2_{{$value.id}}" height="{{size.arrowHeight}}" width="{{size.arrowHeight*size.raw}}"  y="{{size.arrowHeight*(3*$index+2)}}" x="{{(size.width-size.arrowHeight*size.raw)/2}}" fill-opacity="null" stroke-opacity="null" stroke-width="0.5" fill="{{stateArray[$value.state].bgcolor2}}" /><text xml:space="preserve" style="cursor: default" text-anchor="middle" font-family="{{font}}" font-size="{{fontsize}}" id="svg_5_{{$value.id}}" x="50%" y="{{size.arrowHeight*(3*$index+1.6)}}" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="{{stateArray[$value.state].color1}}" fill="{{stateArray[$value.state].color1}}">{{$value.appTime | dateFormat:"yyyy-MM-dd hh:mm"}}</text><text xml:space="preserve" style="cursor: default" text-anchor="middle" font-family="{{font}}" font-size="{{fontsize}}" id="svg_6_{{$value.id}}" x="50%" y="{{size.arrowHeight*(3*$index+2.6)}}" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="{{stateArray[$value.state].color2}}" fill="{{stateArray[$value.state].color2}}">{{stateArray[$value.state].name}}-{{$value.appUserName}}</text></g><line x1="{{size.width/2}}" y1="{{size.arrowHeight*(3*$index+3)}}" x2="{{size.width/2}}" y2="{{size.arrowHeight*(3*$index+4)-5}}" stroke="{{stateArray[$value.state].arrowcolor}}" stroke-width="2" marker-end="url(#arrow_{{$value.state}})" />  {{/each}} <g><rect stroke="{{stateArray[data.state].bgcolor2}}" id="svg_end" height="{{size.arrowHeight}}" width="{{size.arrowHeight*size.raw}}" y="{{size.arrowHeight*(3*data.list.length+1)}}" x="{{(size.width-size.arrowHeight*size.raw)/2}}" stroke-width="0.5" fill="{{stateArray[data.state].bgcolor2}}"></rect><text xml:space="preserve" style="cursor: default" text-anchor="middle" font-family="{{font}}" font-size="{{fontsize}}" id="svg_end_text" x="50%" y="{{size.arrowHeight*(3*data.list.length+1.6)}}" fill-opacity="null" stroke-opacity="null" stroke-width="0" stroke="{{stateArray[data.state].color2}}" fill="{{stateArray[data.state].color2}}">{{stateArray[data.state].name}}</text></g></svg></script>';String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)},Array.prototype.insert=function(e,t){this.splice(e,0,t)},template.helper("dateFormat",function(e,t){return tryFormatDate(e,t)}),$.extend(Plugin.prototype,{init:function(e){var t=$(e.element);try{e._turnData(e.options.renderMap,e.options.data,function(t){e.options.data=t},function(t){$.error(t.message),e.options.error(t)}),t.css("background-color",e.options.bgcolor).css("width",e.options.size.width).css("height",e.options.size.height),"temp_zms_listTable_svgframe_default"==e.options.svgframe&&null==$("#temp_zms_listTable_svgframe_default").html()&&$("body").append(defaultTemplateHtml);var a=template(e.options.svgframe,e.options);t.html(a)}catch(t){$.error(t.message),e.options.error(t)}t.layerid=null,$(".zms_listTable.node").hover(function(){try{e.options.nodeHover&&(t.layerid=e.options.nodeHover(this))}catch(t){$.error(t.message),e.options.error(t)}},function(){layer.close(t.layerid)})}}),$.fn[pluginName]=function(e){return this.each(function(){new Plugin(this,e);return this})}}(jQuery,window,document,template,layer);